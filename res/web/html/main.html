<!DOCTYPE HTML>
<html>
    <head>
        <title>
            Pi Camera Controller
        </title>
        <link rel="stylesheet" href="/include/css/common.css">
        <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    </head>
    <body>
        <script type="text/javascript">
            /*
                Show / hide panels
             */
            function hideRecordSettings() {
                hideElementID("start_settings_div");
                hideElementID("invalid_time_div");
            }

            function hideTakeSnap() {
                hideElementID("snapshot_div");
            }

            function showRecordSettings() {
                showFlexElementID("start_settings_div");
                hideElementID("invalid_time_div");

                hideTakeSnap();
            }

            function showTakeSnapshot() {
                showFlexElementID("snapshot_div");

                hideRecordSettings();
            }

            function showSettings() {
                showFlexElementID("settings_div");

                camera.getCamSettings(true, function(req, json) {
                    document.getElementById("vid_defaults_field").value = JSON.stringify(json.settings);
                });
                camera.getCamSettings(false, function(req, json) {
                    document.getElementById("snap_defaults_field").value = JSON.stringify(json.settings);
                });
                camera.getSystemSettings(function(req, json) {
                    document.getElementById("picam_config_text").value = JSON.stringify(json.settings);
                });
            }

            function hideSettings() {
                hideElementID("settings_div");
            }

            function showVideos() {
                let divName = "video_list_div";
                showFlexElementID(divName);
                createFilelist(true, divName, "Video");
            }

            function showSnapshots() {
                let divName = "snapshot_list_div";
                showFlexElementID(divName);
                createFilelist(false, divName, "Snapshot");
            }

            function closeSnapPreview() {
                hideElementID("preview_snap_div");
            }

            /*
                Trigger camera functions
             */
            function startRecord() {
                let time = document.getElementById("record_time").value;
                let path = document.getElementById("record_text").value;

                if (isNaN(time)) {
                    showFlexElementID("invalid_time_div");
                } else {
                    hideRecordSettings();
                    hideTakeSnap();
                    hideElementID("record_row");

                    camera.recordVideo(time, path);
                }
            }

            function takeSnapshot() {
                camera.recordSnapshot(document.getElementById("snapshot_name").value, function (req, json){
                    camera.getSnapshotPreview(function (req, json){
                       showPreview('p', json.name);
                    });
                });
            }

            function showPreview(filetype, filename) {
                if (filetype === 'p') {
                    let img = document.getElementById("preview_snap_img");
                    img.src = "/func/media/download?p=" + filename;

                    showFlexElementID("preview_snap_div");
                } else if (filetype === 'v') {
                    let vid = document.getElementById("preview_vid_img");
                    vid.src = "/func/media/stream?" + filename;

                    showFlexElementID("preview_vid_div");
                } else {
                    console.log("Invalid preview type: " + filetype);
                }
            }

            function closeVidPreview() {
                hideElementID("preview_vid_div");
            }

            function showVideoSettings() {
                showFlexElementID("vid_settings_div");
                populateVidSettings();
            }

            function hideVideoSettings() {
                hideElementID("vid_settings_div");
            }

            function showSnapSettings() {
                showFlexElementID("snap_settings_div");
                populateSnapSettings();
            }

            function hideSnapSettings() {
                hideElementID("snap_settings_div");
            }

            /*
            function populateCamSettings(isVideo, field) {
                camera.getCamSettings(isVideo, function(req, json) {
                    field.value = JSON.stringify(json);
                });
            }
            */

            function resetPiCamConfig() {
                camera.resetSystemSettings(function () {
                    populateSystemSettings();
                });
            }

            function populateSystemSettings() {
                camera.getSystemSettings(function (req, json) {
                    let text = document.getElementById("picam_config_text");
                    text.value = JSON.stringify(json);
                });
            }

            function applyPiCamConfig() {
                let text = document.getElementById("picam_config_text");
                camera.applySystemSettings(text.value);
            }

            function resetVidSettings() {
                camera.resetCamSettings(true, function() {
                    populateVidSettings();
                });
            }

            function populateVidSettings() {
                camera.getCamSettings(true, function(req, json) {
                    document.getElementById("camera_setting_mode").value = json.settings.md;
                    document.getElementById("camera_setting_width").value = json.settings.w;
                    document.getElementById("camera_setting_height").value = json.settings.h;
                    document.getElementById("camera_setting_fps").value = json.settings.fps;
                    document.getElementById("camera_setting_bitrate").value = json.settings.b;
                    document.getElementById("camera_setting_qp").value = json.settings.qp;
                    document.getElementById("camera_setting_refresh").value = json.settings.g;
                    document.getElementById("camera_setting_pf").value = json.settings.pf;
                    document.getElementById("camera_setting_lev").value = json.settings.lev;
                    document.getElementById("camera_setting_ih").checked = json.settings.ih;
                    document.getElementById("camera_setting_fl").checked = json.settings.fl;
                    document.getElementById("camera_setting_vs").checked = json.settings.vs;
                    document.getElementById("camera_setting_awb").value = json.settings.awb;
                    document.getElementById("camera_setting_drc").value = json.settings.drc;
                    document.getElementById("camera_setting_ex").value = json.settings.ex;
                    document.getElementById("camera_setting_rot").value = json.settings.rot;
                });
            }

            function applyVidSettings(callback = function() {}) {
                let settings = {
                    md: document.getElementById("camera_setting_mode").value,
                    w: document.getElementById("camera_setting_width").value,
                    h: document.getElementById("camera_setting_height").value,
                    fps: document.getElementById("camera_setting_fps").value,
                    b: document.getElementById("camera_setting_bitrate").value,
                    qp: document.getElementById("camera_setting_qp").value,
                    g: document.getElementById("camera_setting_refresh").value,
                    pf: document.getElementById("camera_setting_pf").value,
                    lev: document.getElementById("camera_setting_lev").value,
                    ih: document.getElementById("camera_setting_ih").checked,
                    fl: document.getElementById("camera_setting_fl").checked,
                    vs: document.getElementById("camera_setting_vs").checked,
                    awb: document.getElementById("camera_setting_awb").value,
                    drc: document.getElementById("camera_setting_drc").value,
                    ex: document.getElementById("camera_setting_ex").value,
                    rot: document.getElementById("camera_setting_rot").value
                };
                camera.applyCamSettings(true, JSON.stringify(settings), callback);
            }

            function saveVidSettings() {
                applyVidSettings(function() {
                    camera.saveCamSettings(true);
                });
            }

            function resetSnapSettings() {
                camera.resetCamSettings(false, function() {
                    populateSnapSettings();
                });
            }

            function populateSnapSettings() {
                camera.getCamSettings(false, function(req, json) {
                    document.getElementById("snap_setting_mode").value = json.settings.md;
                    document.getElementById("snap_setting_width").value = json.settings.w;
                    document.getElementById("snap_setting_height").value = json.settings.h;
                    document.getElementById("snap_setting_vs").checked = json.settings.vs;
                    document.getElementById("snap_setting_awb").value = json.settings.awb;
                    document.getElementById("snap_setting_drc").value = json.settings.drc;
                    document.getElementById("snap_setting_ex").value = json.settings.ex;
                    document.getElementById("snap_setting_rot").value = json.settings.rot;
                    document.getElementById("snap_setting_q").value = json.settings.q;
                    document.getElementById("snap_setting_fb").checked = json.settings.bm;
                });
            }

            function applySnapSettings(callback = function() {}) {
                let settings = {
                    md: document.getElementById("snap_setting_mode").value,
                    w: document.getElementById("snap_setting_width").value,
                    h: document.getElementById("snap_setting_height").value,
                    vs: document.getElementById("snap_setting_vs").checked,
                    awb: document.getElementById("snap_setting_awb").value,
                    drc: document.getElementById("snap_setting_drc").value,
                    ex: document.getElementById("snap_setting_ex").value,
                    rot: document.getElementById("snap_setting_rot").value,
                    q: document.getElementById("snap_setting_q").value,
                    bm: document.getElementById("snap_setting_fb").checked,
                };
                camera.applyCamSettings(false, JSON.stringify(settings), callback);
            }

            function saveSnapSettings() {
                applySnapSettings(function() {
                    camera.saveCamSettings(false);
                });
            }
        </script>

        <!-- Main window grid -->
        <div class="grid_main">

            <!-- javascript warning message, removed if javascript loads -->
            <div class="warning_message" id="javascript_warning">
                This site requires javascript to work correctly.
            </div>

            <!-- banner that show version -->
            <h1 class="top_grid_row" id="controller_version">
                Pi Camera Controller ???
            </h1>

            <!-- First row, shows camera recording status -->
            <div class="grid_row">
                <div class="grid_item_long">
                    Camera status:
                </div>
                <div class="grid_item" id="cam_status">
                    <div style="color: yellow">
                        unknown
                    </div>
                </div>
            </div>

            <!-- Second row, recording buttons -->
            <div class="grid_row" id="record_row">
                <div class="grid_item_long">
                    Record:
                </div>
                <!-- Record a video -->
                <div class="grid_item">
                    <input type="button" value="Video" onclick="showRecordSettings()">
                </div>
                <!-- Record a snapshot-->
                <div class="grid_item">
                    <input type="button" value="Snapshot" onclick="showTakeSnapshot()">
                </div>
            </div>

            <!-- hidden inner grid, settings for recording video -->
            <div class="inner_grid_main" id="start_settings_div" style="display: none; justify-content: flex-start">
                <!-- first row of hidden grid, title/record button -->
                <div class="inner_grid_row">
                    <div class="grid_item_title">
                        Record video:
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Start" onclick="startRecord()">
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Cancel" onclick="hideRecordSettings()">
                    </div>
                </div>
                <!-- second hidden row, duration setting -->
                <div class="inner_grid_row" style="align-items: baseline">
                    <div class="grid_item_long">
                        Duration:
                    </div>
                    <div class="grid_item">
                        <input type="text" id="record_time" value="0">
                    </div>
                </div>
                <!-- third hidden row, output filename -->
                <div class="inner_grid_row" style="align-items: baseline">
                    <p class="grid_item_long">
                        Filename:
                    </p>
                    <div class="grid_item">
                        <input type="text" id="record_text" value="my_video">
                    </div>
                </div>
            </div>

            <!-- hidden warning row, displayed if duration is not an integer -->
            <div class="grid_row" id="invalid_time_div" style="display: none; color: red;">
                Please enter a number of seconds to record for, <br>
                or enter 0 to record until canceled.<br>
                <input type="button" value="Close" onclick="hideElementID('invalid_time_div')">
            </div>

            <!-- hidden row for recording progress -->
            <div class="grid_row" id="rec_progress_div" style="display: none">
                <div class="grid_item">
                    Recording to:
                </div>
                <div class="grid_item" id="recording_path">
                    N/A
                </div>
                <br>
                <div class="grid_item">
                    Time:
                </div>
                <div class="grid_item" id="recording_time">
                    N/A
                </div>
                <div class="grid_item">
                    <input type="button" value="Stop" onclick="camera.stopRecording()">
                </div>
            </div>

            <!-- hidden inner grid for recording snapshots -->
            <div class="inner_grid_main" id="snapshot_div" style="display: none">
                <!-- inner row with title / record button -->
                <div class="inner_grid_row">
                    <div class="grid_item_title">
                        Record snapshot:
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Save" onclick="takeSnapshot()">
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Cancel" onclick="hideTakeSnap()">
                    </div>
                </div>
                <!-- inner row with filename -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Filename:
                    </div>
                    <div class="grid_item">
                        <input type="text" id="snapshot_name" value="my_picture">
                    </div>
                </div>
            </div>

            <!-- row with file browser buttons -->
            <div class="grid_row">
                <div class="grid_item_long">
                    Browse:
                </div>
                <div class="grid_item">
                    <input type="button" value="Video" onclick="showVideos()">
                </div>
                <div class="grid_item">
                    <input type="button" value="Snapshot" onclick="showSnapshots()">
                </div>
            </div>

            <!-- hidden inner grid with video files - populated by JS -->
            <div class="inner_grid_main" id="video_list_div" style="display: none">
            </div>

            <!-- hidden inner grid with video preview -->
            <div class="inner_grid_main" id="preview_vid_div" style="display: none">
                <div class="inner_grid_row">
                    <div class="grid_item_title">
                        Video preview:
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Close" onclick="closeVidPreview()">
                    </div>
                </div>
                <div class="inner_grid_row">
                    <div class="grid_item" style="max-width: 600px">
                        <video id="preview_vid_img" width="600" src="#" controls>
                            Your browser does not support video playback.
                        </video>
                    </div>
                </div>
            </div>

            <!-- hidden inner grid with snapshot files - populated by JS -->
            <div class="inner_grid_main" id="snapshot_list_div" style="display: none">
            </div>

            <!-- hidden inner grid with snapshot preview -->
            <div class="inner_grid_main" id="preview_snap_div" style="display: none">
                <div class="inner_grid_row">
                    <div class="grid_item_title">
                        Snapshot preview:
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Close" onclick="closeSnapPreview()">
                    </div>
                </div>
                <div class="inner_grid_row">
                    <div class="grid_item" style="max-width: 600px">
                        <img id="preview_snap_img" width="600" src="#" alt="Snapshot">
                    </div>
                </div>
            </div>

            <!-- row with camera settings buttons -->
            <div class="grid_row">
                <div class="grid_item_long">
                    Settings:
                </div>
                <div class="grid_item">
                    <input type="button" value="Video" onclick="showVideoSettings()">
                </div>
                <div class="grid_item">
                    <input type="button" value="Snapshot" onclick="showSnapSettings()">
                </div>
            </div>

            <!-- hidden gridrow with video settings -->
            <div class="inner_grid_main" id="vid_settings_div" style="display: none">
                <!-- Title row -->
                <div class="inner_grid_row">
                    <div class="grid_item_title">
                        Video settings:
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Reset" onclick="resetVidSettings()">
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Apply" onclick="applyVidSettings()">
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Save" onclick="saveVidSettings()">
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Close" onclick="hideVideoSettings()">
                    </div>
                </div>
                <!-- Camera mode setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Camera mode:
                    </div>
                    <div class="grid_item">
                        <select id="camera_setting_mode">
                            <option value="0">Auto</option>
                            <option value="1">1920x1080 (30FPS max)</option>
                            <option value="2">2592x1944 (15FPS max)</option>
                            <option value="3">2592x1944 (1FPS max)</option>
                            <option value="4">1296x972 (42FPS max)</option>
                            <option value="5">1296x730 (49FPS max)</option>
                            <option value="6">640x480 (60FPS max)</option>
                            <option value="7">640x480 (90FPS max)</option>
                        </select>
                    </div>
                </div>
                <!-- Camera dimensions settings -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Video dimensions:
                    </div>
                    <div class="grid_item">
                        <input pattern="\d*" size="5" id="camera_setting_width"/>
                    </div>
                    <div class="grid_item">
                        x
                    </div>
                    <div class="grid_item">
                        <input pattern="\d*" size="5" id="camera_setting_height"/>
                    </div>
                </div>
                <!-- Camera FPS setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Framerate (FPS):
                    </div>
                    <div class="grid_item">
                        <input pattern="\d*" size="4" id="camera_setting_fps"/>
                    </div>
                </div>
                <!-- Camera bitrate setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Bitrate (0 is VBR):
                    </div>
                    <div class="grid_item">
                        <input pattern="\d*" size="10" id="camera_setting_bitrate"/>
                    </div>
                </div>
                <!-- Camera QP setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Quaternization Parameter:
                    </div>
                    <div class="grid_item">
                        <input pattern="\d*" size="10" id="camera_setting_qp"/>
                    </div>
                </div>
                <!-- Camera refresh setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Intra-refresh period:
                    </div>
                    <div class="grid_item">
                        <input pattern="\d*" size="10" id="camera_setting_refresh"/>
                    </div>
                </div>
                <!-- Camera profile setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        H264 Profile:
                    </div>
                    <div class="grid_item">
                        <select id="camera_setting_pf">
                            <option value="baseline">Baseline (low quality)</option>
                            <option value="main">Main (middle quality)</option>
                            <option value="high">High (high quality)</option>
                        </select>
                    </div>
                </div>
                <!-- Camera level setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        H264 Level:
                    </div>
                    <div class="grid_item">
                        <select id="camera_setting_lev">
                            <option value="4">4 (simple file)</option>
                            <option value="4.1">4.1 (normal file)</option>
                            <option value="4.2">4.2 (complex file)</option>
                        </select>
                    </div>
                </div>
                <!-- Camera video stabilisation setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Video Stabilization:
                    </div>
                    <div class="grid_item">
                        <input type="checkbox" id="camera_setting_vs" value="">
                    </div>
                </div>
                <!-- Camera awb setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Automatic White Balance:
                    </div>
                    <div class="grid_item">
                        <select id="camera_setting_awb">
                            <option value="off">Off</option>
                            <option value="auto">Automatic</option>
                            <option value="sun">Sun</option>
                            <option value="cloud">Cloud</option>
                            <option value="shade">Shade</option>
                            <option value="tungsten">Tungsten</option>
                            <option value="florescent">Florescent</option>
                            <option value="incandescent">Incandescent</option>
                            <option value="flash">Flash</option>
                            <option value="horizon">Horizon</option>
                        </select>
                    </div>
                </div>
                <!-- Camera drc setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Dynamic Range Compression:
                    </div>
                    <div class="grid_item">
                        <select id="camera_setting_drc">
                            <option value="off">Off</option>
                            <option value="low">Low</option>
                            <option value="med">Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                </div>
                <!-- Camera exposure setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Exposure mode:
                    </div>
                    <div class="grid_item">
                        <select id="camera_setting_ex">
                            <option value="auto">Automatic</option>
                            <option value="night">Night</option>
                            <option value="backlight">Backlight</option>
                            <option value="spotlight">Spotlight</option>
                            <option value="sports">Sports</option>
                            <option value="snow">Snow</option>
                            <option value="beach">Beach</option>
                            <option value="verylong">Long shutter</option>
                            <option value="fixedfps">Fixed FPS</option>
                            <option value="antishake">Anti-shake</option>
                            <option value="firewroks">Fireworks</option>
                        </select>
                    </div>
                </div>
                <!-- Camera rotation setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Rotation:
                    </div>
                    <div class="grid_item">
                        <select id="camera_setting_rot">
                            <option value="0">0</option>
                            <option value="90">90</option>
                            <option value="180">180</option>
                            <option value="270">270</option>
                        </select>
                    </div>
                </div>
                <!-- Camera inline headers setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Inline headers:
                    </div>
                    <div class="grid_item">
                        <input type="checkbox" id="camera_setting_ih" value="">
                    </div>
                </div>
                <!-- Camera flush buffers setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Flush Buffers:
                    </div>
                    <div class="grid_item">
                        <input type="checkbox" id="camera_setting_fl" value="">
                    </div>
                </div>
            </div>
            <!-- hidden gridrow with snapshot settings -->
            <div class="inner_grid_main" id="snap_settings_div" style="display: none">
                <!-- Title row -->
                <div class="inner_grid_row">
                    <div class="grid_item_title">
                        Snapshot settings:
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Reset" onclick="resetSnapSettings()">
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Apply" onclick="applySnapSettings()">
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Save" onclick="saveSnapSettings()">
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Close" onclick="hideSnapSettings()">
                    </div>
                </div>
                <!-- Camera mode setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Camera mode:
                    </div>
                    <div class="grid_item">
                        <select id="snap_setting_mode">
                            <option value="0">Auto</option>
                            <option value="1">1920x1080 (30FPS max)</option>
                            <option value="2">2592x1944 (15FPS max)</option>
                            <option value="3">2592x1944 (1FPS max)</option>
                            <option value="4">1296x972 (42FPS max)</option>
                            <option value="5">1296x730 (49FPS max)</option>
                            <option value="6">640x480 (60FPS max)</option>
                            <option value="7">640x480 (90FPS max)</option>
                        </select>
                    </div>
                </div>
                <!-- Camera dimensions settings -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Picture dimensions:
                    </div>
                    <div class="grid_item">
                        <input pattern="\d*" size="5" id="snap_setting_width"/>
                    </div>
                    <div class="grid_item">
                        x
                    </div>
                    <div class="grid_item">
                        <input pattern="\d*" size="5" id="snap_setting_height"/>
                    </div>
                </div>
                <!-- Camera video stabilisation setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Video Stabilization:
                    </div>
                    <div class="grid_item">
                        <input type="checkbox" id="snap_setting_vs" value="">
                    </div>
                </div>
                <!-- Camera awb setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Automatic White Balance:
                    </div>
                    <div class="grid_item">
                        <select id="snap_setting_awb">
                            <option value="off">Off</option>
                            <option value="auto">Automatic</option>
                            <option value="sun">Sun</option>
                            <option value="cloud">Cloud</option>
                            <option value="shade">Shade</option>
                            <option value="tungsten">Tungsten</option>
                            <option value="florescent">Florescent</option>
                            <option value="incandescent">Incandescent</option>
                            <option value="flash">Flash</option>
                            <option value="horizon">Horizon</option>
                        </select>
                    </div>
                </div>
                <!-- Camera drc setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Dynamic Range Compression:
                    </div>
                    <div class="grid_item">
                        <select id="snap_setting_drc">
                            <option value="off">Off</option>
                            <option value="low">Low</option>
                            <option value="med">Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                </div>
                <!-- Camera exposure setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Exposure mode:
                    </div>
                    <div class="grid_item">
                        <select id="snap_setting_ex">
                            <option value="auto">Automatic</option>
                            <option value="night">Night</option>
                            <option value="backlight">Backlight</option>
                            <option value="spotlight">Spotlight</option>
                            <option value="sports">Sports</option>
                            <option value="snow">Snow</option>
                            <option value="beach">Beach</option>
                            <option value="verylong">Long shutter</option>
                            <option value="fixedfps">Fixed FPS</option>
                            <option value="antishake">Anti-shake</option>
                            <option value="firewroks">Fireworks</option>
                        </select>
                    </div>
                </div>
                <!-- Camera rotation setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Rotation:
                    </div>
                    <div class="grid_item">
                        <select id="snap_setting_rot">
                            <option value="0">0</option>
                            <option value="90">90</option>
                            <option value="180">180</option>
                            <option value="270">270</option>
                        </select>
                    </div>
                </div>
                <!-- Camera quality settings -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        JPEG Quality:
                    </div>
                    <div class="grid_item">
                        <input pattern="\d*" size="3" id="snap_setting_q"/>
                    </div>
                </div>
                <!-- Camera frameburst setting -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Frameburst mode:
                    </div>
                    <div class="grid_item">
                        <input type="checkbox" id="snap_setting_fb" value="">
                    </div>
                </div>
            </div>

            <!-- system functions -->
            <div class="grid_row">
                <div class="grid_item_long">
                    System:
                </div>
                <!-- Admin -->
                <div class="grid_item">
                    <input type="button" value="Admin" onclick="showFlexElementID('admin_settings_div')">
                </div>
                <!-- Debug -->
                <div class="grid_item">
                    <input type="button" value="Debug" onclick="showFlexElementID('debug_settings_div')">
                </div>
                <!-- Settings -->
                <div class="grid_item">
                    <input type="button" value="Settings" onclick="showSettings()">
                </div>
            </div>

            <!-- hidden gridrow with settings -->
            <div class="inner_grid_main" id="settings_div" style="display: none">
                <!-- Title row -->
                <div class="inner_grid_row">
                    <div class="grid_item_title">
                        Camera settings:
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Close" onclick="hideSettings()">
                    </div>
                </div>
                <!-- Config header -->
                <div class="inner_grid_row">
                    <div class="grid_item_title">
                        PiCam config:
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Reset" onclick="resetPiCamConfig()">
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Apply" onclick="applyPiCamConfig()">
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Save" onclick="camera.saveSystemSettings()">
                    </div>
                </div>
                <!-- Config file contents -->
                <div class="inner_grid_row">
                    <div class="grid_item">
                        <textarea id="picam_config_text" cols="60" rows="20"></textarea>
                    </div>
                </div>
            </div>

            <!-- hidden gridrow with admin settings -->
            <div class="inner_grid_main" id="admin_settings_div" style="display: none">
                <!-- Title row -->
                <div class="inner_grid_row">
                    <div class="grid_item_title">
                        Admin controls:
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Close" onclick="hideElementID('admin_settings_div')">
                    </div>
                </div>
                <!-- Power controls -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Power:
                    </div>
                    <!-- Exit -->
                    <div class="grid_item">
                        <input type="button" value="Exit" onclick="camera.exitProgram()">
                    </div>
                    <!-- Reboot -->
                    <div class="grid_item">
                        <input type="button" value="Reboot" onclick="camera.rebootPi()">
                    </div>
                    <!-- Shutdown -->
                    <div class="grid_item">
                        <input type="button" value="Shutdown" onclick="camera.shutdownPi()">
                    </div>
                </div>
                <!-- Filesystem controls -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Filesystem:
                    </div>
                    <!-- Clear cachr -->
                    <div class="grid_item">
                        <input type="button" value="Erase Cache" onclick="camera.eraseCache()">
                    </div>
                    <!-- Mount RO -->
                    <div class="grid_item">
                        <input type="button" value="Mount R/O" onclick="camera.remountFS(false)">
                    </div>
                    <!-- Mount RW -->
                    <div class="grid_item">
                        <input type="button" value="Mount R/W" onclick="camera.remountFS(true)">
                    </div>
                    <!-- Synchronise FS -->
                    <div class="grid_item">
                        <input type="button" value="Sync" onclick="camera.syncFS()">
                    </div>
                </div>
            </div>
            <!-- debug settings -->
            <div class="inner_grid_main" id="debug_settings_div" style="display: none">
                <!-- Title row -->
                <div class="inner_grid_row">
                    <div class="grid_item_title">
                        Debug tools:
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Close" onclick="hideElementID('debug_settings_div')">
                    </div>
                </div>
                <!-- Speed test -->
                <div class="inner_grid_row">
                    <div class="grid_item_long">
                        Speed test:
                    </div>
                    <div class="grid_item">
                        <a href="/func/debug/speedtest?1">XS</a>
                    </div>
                    <div class="grid_item">
                        <a href="/func/debug/speedtest?64">S</a>
                    </div>
                    <div class="grid_item">
                        <a href="/func/debug/speedtest?128">M</a>
                    </div>
                    <div class="grid_item">
                        <a href="/func/debug/speedtest?256">L</a>
                    </div>
                    <div class="grid_item">
                        <a href="/func/debug/speedtest?1024">XL</a>
                    </div>
                </div>
            </div>
        </div>

        <script src="/include/js/common.js"></script>
        <script src="/include/js/camera.js"></script>
        <script src="/include/js/status.js"></script>
        <script src="/include/js/filelist.js"></script>
    </body>
</html>
<!DOCTYPE HTML>
<html>
    <head>
        <title>
            Pi Camera Controller
        </title>
        <link rel="stylesheet" href="/include/css/common.css">
        <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    </head>
    <body>
        <script type="text/javascript">
            function cancelRecord() {
                document.getElementById("record_button").value = "Video";
                document.getElementById("start_settings_div").style.display = "none";
            }

            function cancelSnap() {
                document.getElementById("show_snapshot_button").value = "Snapshot";
                document.getElementById("snapshot_div").style.display = "none";
            }

            function showStart() {
                var recButton = document.getElementById("record_button");
                if (recButton.value === "Video") {
                    recButton.value = "Cancel";
                    document.getElementById("start_settings_div").style.display = "flex";
                    document.getElementById("invalid_time_div").style.display = "none";

                    cancelSnap();
                } else if (recButton.value === "Cancel") {
                    cancelRecord()
                } else { //stop
                    stopRecording();
                }
            }

            function startNow() {
                var time = document.getElementById("record_time").value;
                var path = document.getElementById("record_text").value;
                var settings = document.getElementById("camera_settings").value;

                if (isNaN(time)) {
                    document.getElementById("invalid_time_div").style.display = "flex";
                } else {
                    document.getElementById("record_button").value = "Video";
                    document.getElementById("start_settings_div").style.display = "none";
                    //document.getElementById("start_button_div").style.display = "none";
                    document.getElementById("invalid_time_div").style.display = "none";
                    document.getElementById("record_button").value = "Stop";


                    document.getElementById("show_snapshot_div").style.display = "none";
                    document.getElementById("snapshot_div").style.display = "none";

                    startRecording(time, path, settings);
                }
            }

            function snapshot() {
                var div = document.getElementById("last_snapshot_div");
                var img = document.getElementById("last_snapshot_img");
                takeSnapshot(document.getElementById("snapshot_name").value, div, img);
            }

            function showSnapshot() {
                var snapButton = document.getElementById("show_snapshot_button");
                if (snapButton.value === "Snapshot") {
                    snapButton.value = "Cancel";
                    document.getElementById("snapshot_div").style.display = "flex";

                    cancelRecord();
                } else {
                    cancelSnap();
                }
            }

            function browseVideos() {
                var button = document.getElementById("browse_vid_button");
                var div = document.getElementById("video_list_div");

                if (button.value === "Video") {
                    button.value = "Close";
                    div.style.display = "flex";

                    createFilelist("v", "video_list_div", "Video");
                } else {
                    button.value = "Video";
                    div.style.display = "none";
                }
            }

            function browseSnapshots() {
                var button = document.getElementById("browse_snapshot_button");
                var div = document.getElementById("snapshot_list_div");

                if (button.value === "Snapshot") {
                    button.value = "Close";
                    div.style.display = "flex";

                    createFilelist("p", "snapshot_list_div", "Snapshot");
                } else {
                    button.value = "Snapshot";
                    div.style.display = "none";
                }
            }

            function closeLastSnapshot() {
                document.getElementById("last_snapshot_div").style.display = "none";
            }

            function showSettings() {
                var div = document.getElementById("settings_div");
                var vidSettings = document.getElementById("vid_defaults_field");
                var snapSettings = document.getElementById("snap_defaults_field");

                div.style.display = "flex";
                populateSettings('v', vidSettings);
                populateSettings('p', snapSettings);
            }

            function hideSettings() {
                var div = document.getElementById("settings_div");
                div.style.display = "none";
            }

            function resetVidSettings() {
                resetSettings('v', document.getElementById("vid_defaults_field"));
            }

            function resetSnapSettings() {
                resetSettings('s', document.getElementById("snap_defaults_field"));
            }
        </script>

        <!-- Main window grid -->
        <div class="grid_main">

            <!-- javascript warning message, removed if javascript loads -->
            <div class="warning_message" id="javascript_warning">
                This site requires javascript to work correctly.
            </div>

            <!-- banner that show version -->
            <h1 class="top_grid_row" id="controller_version">
                Pi Camera Controller ???
            </h1>

            <!-- First row, shows camera recording status -->
            <div class="grid_row">
                <div class="grid_item" style="flex-grow: 1;">
                    Camera status:
                </div>
                <div class="grid_item" id="cam_status">
                    <div style="color: yellow">
                        unknown
                    </div>
                </div>
            </div>

            <!-- Second row, recording buttons -->
            <div class="grid_row">
                <div class="grid_item" style="flex-grow: 1;">
                    Record:
                </div>
                <!-- Record a video -->
                <div class="grid_item">
                    <input type="button" id="record_button" value="Video" onclick="showStart()">
                </div>
                <!-- Record a snapshot -->
                <div class="grid_item" id="show_snapshot_div">
                    <input type="button" id="show_snapshot_button" value="Snapshot" onclick="showSnapshot()">
                </div>
            </div>

            <!-- hidden inner grid, settings for recording video -->
            <div class="inner_grid_main" id="start_settings_div" style="display: none; justify-content: flex-start">
                <!-- first row of hidden grid, title/record button -->
                <div class="inner_grid_row">
                    <div class="grid_item" style="flex-grow: 1;">
                        Record video:
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Start" onclick="startNow()">
                    </div>
                </div>
                <!-- second hidden row, duration setting -->
                <div class="inner_grid_row" style="align-items: baseline">
                    <div class="grid_item" style="flex-grow: 1;">
                        Duration:
                    </div>
                    <div class="grid_item">
                        <input type="text" id="record_time" value="0">
                    </div>
                </div>
                <!-- third hidden row, output filename -->
                <div class="inner_grid_row" style="align-items: baseline">
                    <p class="grid_item" style="flex-grow: 1;">
                        Filename:
                    </p>
                    <div class="grid_item">
                        <input type="text" id="record_text" value="my_video">
                    </div>
                </div>
                <!-- fourth row, camera settings -->
                <div class="inner_grid_row" style="align-items: baseline">
                    <p class="grid_item" style="flex-grow: 1;">
                        Settings:
                    </p>
                    <div class="grid_item">
                        <input type="text" id="camera_settings" value="">
                    </div>
                </div>
            </div>

            <!-- hidden warning row, displayed if duration is not an integer -->
            <div class="grid_row" id="invalid_time_div" style="display: none; color: red;">
                Please enter a number of seconds to record for, <br>
                or enter 0 to record until canceled.<br>
                <input type="button" value="Close" onclick="document.getElementById('invalid_time_div').style.display = 'none'">
            </div>

            <!-- hidden row for recording progress -->
            <div class="grid_row" id="rec_progress_div" style="display: none">
                <div class="grid_item">
                    Recording to:
                </div>
                <div class="grid_item" id="recording_path">
                    N/A
                </div>
                <br>
                <div class="grid_item">
                    Time:
                </div>
                <div class="grid_item" id="recording_time">
                    N/A
                </div>
            </div>

            <!-- hidden inner grid for recording snapshots -->
            <div class="inner_grid_main" id="snapshot_div" style="display: none">
                <!-- inner row with title / record button -->
                <div class="inner_grid_row">
                    <div class="grid_item" style="flex-grow: 1;">
                        Record snapshot:
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Save" onclick="snapshot()">
                    </div>
                </div>
                <!-- inner row with filename -->
                <div class="inner_grid_row">
                    <div class="grid_item" style="flex-grow: 1;">
                        Filename:
                    </div>
                    <div class="grid_item">
                        <input type="text" id="snapshot_name" value="my_picture">
                    </div>
                </div>
            </div>

            <!-- row with file browser buttons -->
            <div class="grid_row">
                <div class="grid_item" style="flex-grow: 1;">
                    Browse:
                </div>
                <div class="grid_item">
                    <input type="button" id="browse_vid_button" value="Video" onclick="browseVideos()">
                </div>
                <div class="grid_item">
                    <input type="button" id="browse_snapshot_button" value="Snapshot" onclick="browseSnapshots()">
                </div>
            </div>

            <!-- hidden inner grid with video files - populated by JS -->
            <div class="inner_grid_main" id="video_list_div" style="display: none">
            </div>

            <!-- hidden inner grid with snapshot files - populated by JS -->
            <div class="inner_grid_main" id="snapshot_list_div" style="display: none">
            </div>

            <!-- hidden inner grid with last snapshot -->
            <div class="inner_grid_main" id="last_snapshot_div" style="display: none">
                <div class="inner_grid_row">
                    <div class="grid_item" style="flex-grow: 1;">
                        Last snapshot:
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Close" onclick="closeLastSnapshot()">
                    </div>
                </div>
                <div class="inner_grid_row">
                    <div class="grid_item" style="max-width: 400px">
                        <img id="last_snapshot_img" width="400" src="#" alt="Last snapshot">
                    </div>
                </div>
            </div>

            <!-- system functions -->
            <div class="grid_row">
                <div class="grid_item" style="flex-grow: 1;">
                    System:
                </div>
                <!-- Settings -->
                <div class="grid_item">
                    <input type="button" value="Settings" onclick="showSettings()">
                </div>
                <!-- Exit -->
                <div class="grid_item">
                    <input type="button" value="Exit" onclick="exitProgram()">
                </div>
                <!-- Reboot -->
                <div class="grid_item">
                    <input type="button" value="Reboot" onclick="rebootSystem()">
                </div>
            </div>

            <!-- hidden gridrow with settings -->
            <div class="inner_grid_main" id="settings_div" style="display: none">
                <!-- Title row -->
                <div class="inner_grid_row">
                    <div class="grid_item" style="flex-grow: 1;">
                        Camera settings:
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Close" onclick="hideSettings()">
                    </div>
                </div>
                <!-- video settings -->
                <div class="inner_grid_row">
                    <div class="grid_item" style="flex-grow: 1;">
                        Video defaults:
                    </div>
                    <div class="grid_item">
                        <input type="text" id="vid_defaults_field" value="">
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Reset" onclick="resetVidSettings()">
                    </div>
                </div>
                <!-- picture defaults -->
                <div class="inner_grid_row">
                    <div class="grid_item" style="flex-grow: 1;">
                        Snapshot defaults:
                    </div>
                    <div class="grid_item">
                        <input type="text" id="snap_defaults_field" value="">
                    </div>
                    <div class="grid_item">
                        <input type="button" value="Reset" onclick="resetSnapSettings()">
                    </div>
                </div>
            </div>
        </div>

        <script src="/include/js/common.js"></script>
        <script src="/include/js/status.js"></script>
        <script src="/include/js/commands.js"></script>
        <script src="/include/js/filelist.js"></script>
    </body>
</html>
<!DOCTYPE HTML>
<html>
    <head>
        <title>
            Pi Camera Controller
        </title>
        <link rel="stylesheet" href="/include/css/common.css">
        <meta name='viewport' content='width=device-width, initial-scale=1.0'>
        <style>
            .setting_label {
                flex-grow: 1;
                margin: 5px 0;
            }
        </style>
    </head>
    <body>
        <script type="text/javascript">
            function cancelRecord() {
                document.getElementById("record_button").value = "Video";
                document.getElementById("start_settings_div").style.display = "none";
            }

            function cancelSnap() {
                document.getElementById("show_snapshot_button").value = "Picture";
                document.getElementById("snapshot_div").style.display = "none";
            }

            function showStart() {
                var recButton = document.getElementById("record_button");
                if (recButton.value === "Video") {
                    recButton.value = "Cancel";
                    document.getElementById("start_settings_div").style.display = "flex";
                    document.getElementById("invalid_time_div").style.display = "none";

                    cancelSnap();
                } else if (recButton.value === "Cancel") {
                    cancelRecord()
                } else { //stop
                    stopRecording();
                }
            }

            function startNow() {
                var time = document.getElementById("record_time").value;
                var path = document.getElementById("record_text").value;
                var settings = document.getElementById("camera_settings").value;

                if (isNaN(time)) {
                    document.getElementById("invalid_time_div").style.display = "flex";
                } else {
                    document.getElementById("record_button").value = "Video";
                    document.getElementById("start_settings_div").style.display = "none";
                    //document.getElementById("start_button_div").style.display = "none";
                    document.getElementById("invalid_time_div").style.display = "none";
                    document.getElementById("record_button").value = "Stop";


                    document.getElementById("show_snapshot_div").style.display = "none";
                    document.getElementById("snapshot_div").style.display = "none";

                    startRecording(time, path, settings);
                }
            }

            function snapshot() {
                takeSnapshot(document.getElementById("snapshot_name").value);
            }

            function showSnapshot() {
                var snapButton = document.getElementById("show_snapshot_button");
                if (snapButton.value === "Picture") {
                    snapButton.value = "Cancel";
                    document.getElementById("snapshot_div").style.display = "flex";

                    cancelRecord();
                } else {
                    cancelSnap();
                }
            }

            function browseVideos() {
                var button = document.getElementById("browse_vid_button");
                var div = document.getElementById("video_list_div");

                if (button.value === "Videos") {
                    button.value = "Close";
                    div.style.display = "flex";

                    createFilelist("v", "video_list_div", "Video");
                } else {
                    button.value = "Videos";
                    div.style.display = "none";
                }
            }

            function browseSnapshots() {
                var button = document.getElementById("browse_snapshot_button");
                var div = document.getElementById("snapshot_list_div");

                if (button.value === "Snapshots") {
                    button.value = "Close";
                    div.style.display = "flex";

                    createFilelist("p", "snapshot_list_div", "Snapshot");
                } else {
                    button.value = "Snapshots";
                    div.style.display = "none";
                }
            }
        </script>

        <div class="grid_main">
            <p class="warning_message" id="javascript_warning">
                This site requires javascript to work correctly.
            </p>
            <h1 class="top_grid_row" id="controller_version">
                Pi Camera Controller ???
            </h1>
            <div class="grid_row">
                <div class="grid_item">
                    Camera status:
                </div>
                <div class="grid_item" id="cam_status">
                    <div style="color: yellow">
                        unknown
                    </div>
                </div>
            </div>
            <div class="grid_row">
                <div class="grid_item">
                    <input type="button" id="record_button" value="Video" onclick="showStart()">
                </div>
                <div class="grid_item" id="show_snapshot_div">
                    <input type="button" id="show_snapshot_button" value="Picture" onclick="showSnapshot()">
                </div>
            </div>
            <div class="inner_grid_main" id="start_settings_div" style="display: none; justify-content: flex-start">
                <div class="inner_grid_row">
                    <input type="button" value="Start" onclick="startNow()">
                </div>
                <div class="inner_grid_row" style="align-items: baseline">
                    <p class="setting_label">
                        Record for:
                    </p>
                    <input type="text" id="record_time" value="0">
                </div>
                <div class="inner_grid_row" style="align-items: baseline">
                    <p class="setting_label">
                        Filename:
                    </p>
                    <input type="text" id="record_text" value="my_video">
                </div>
                <div class="inner_grid_row" style="align-items: baseline">
                    <p class="setting_label">
                        Camera settings:
                    </p>
                    <input type="text" id="camera_settings" value="">
                </div>
            </div>
            <div class="grid_row" id="invalid_time_div" style="display: none; color: red;">
                Please enter a number of seconds to record for, <br>
                or enter 0 to record until canceled.<br>
                <input type="button" value="Close" onclick="document.getElementById('invalid_time_div').style.display = 'none'">
            </div>
            <div class="grid_row" id="rec_progress_div" style="display: none">
                <div class="grid_item">
                    Recording to:
                </div>
                <div class="grid_item" id="recording_path">
                    N/A
                </div>
                <br>
                <div class="grid_item">
                    Time:
                </div>
                <div class="grid_item" id="recording_time">
                    N/A
                </div>
            </div>
            <div class="grid_row" id="snapshot_div" style="display: none">
                <div class="grid_item">
                    <input type="button" value="Take snapshot" onclick="snapshot()">
                </div>
                <div class="grid_item">
                    <input type="text" id="snapshot_name" value="my_picture">
                </div>
            </div>
            <div class="grid_row">
                <div class="grid_item">
                    Browse:
                </div>
                <div class="grid_item">
                    <input type="button" id="browse_vid_button" value="Videos" onclick="browseVideos()">
                </div>
                <div class="grid_item">
                    <input type="button" id="browse_snapshot_button" value="Snapshots" onclick="browseSnapshots()">
                </div>
            </div>
            <div class="inner_grid_main" id="video_list_div" style="display: none">
            </div>
            <div class="inner_grid_main" id="snapshot_list_div" style="display: none">
            </div>
        </div>

        <script src="/include/js/common.js"></script>
        <script src="/include/js/status.js"></script>
        <script src="/include/js/commands.js"></script>
        <script src="/include/js/filelist.js"></script>
    </body>
</html>